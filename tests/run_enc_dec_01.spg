<?xml version="1.0"?>
<spg code="testlib">

    <env id="Plaintext" code="list">
        <description>
            Plaintext
        </description>
        <config data="This is my plain,This is another plaintxt,This is a 3rd plaintext" delay="0.1"/>
        <flow sarg="data" sink="Branch Plaintext" darg="data"/>
    </env>

    <branch id="Branch Plaintext">
        <description>
            Split the plaintext to feed into encryption and comparator
            (used to compare with decrypted value)
        </description>
        <flow sarg="data#1" sink="Encrypt" darg="plaintext"/>
        <flow sarg="data#2" sink="Pad" darg="data"/>
    </branch>

    <const id="IV">
        <description>
            Initial counter
        </description>
        <config hex="DEADBEEFdEADC0DE"/>
        <flow sarg="const" sink="Encrypt" darg="ctr"/>
    </const>

    <const id="Key">
        <description>
            Encryption key
        </description>
        <config bytes="MyVerySecretKey7"/>
        <flow sarg="const" sink="Branch Key" darg="data"/>
    </const>

    <branch id="Branch Key">
        <description>
            Branch Encryption key to encryption/decryption
        </description>
        <flow sarg="data#1" sink="Encrypt" darg="key"/>
        <flow sarg="data#2" sink="Decrypt" darg="key"/>
    </branch>

    <encrypt_ctr id="Encrypt">
        <description>
            Counter-mode encryption of input value
        </description>
        <config keylen="128"/>
        <flow sarg="ciphertext" sink="Decrypt" darg="ciphertext"/>
        <flow sarg="ctr" sink="Decrypt" darg="ctr"/>
    </encrypt_ctr>

    <decrypt id="Decrypt">
        <description>
            Counter-mode decryption of input value
        </description>
        <config keylen="128"/>
        <flow sarg="plaintext" sink="Compare" darg="data1"/>
    </decrypt>

    <xform id="Pad" code="aes_pad">
        <description>
            Pad input data to AES blocksize to allow comarison with
            decryption output
        </description>
        <flow sarg="data" sink="Compare" darg="data2"/>
    </xform>

    <comp id="Compare">
        <description>
            Compare both values
        </description>
        <flow sarg="result" sink="Check" darg="data"/>
    </comp>

    <env id="Check" code="check_fixed">
        <description>
            Check whether comparison yields true
        </description>
        <config result="True,True,True"/>
        <arg name="data"/>
    </env>

</spg>
